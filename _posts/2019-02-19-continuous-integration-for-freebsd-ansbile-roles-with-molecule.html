---
layout: post
title: Continuous integration for FreeBSD Ansbile Roles with molecule
tag:
- ansible
- molecule
- testing
- openstack
- freebsd
---

<p>The modern software engineering, in order to find any bug before they appear in production, uses <a href="https://it.atlassian.com/continuous-delivery/principles/continuous-integration-vs-delivery-vs-deployment">CI/CD</a> paradigm. This paradigm could be also applied to Ansible roles and playbooks, for instance using <a href="https://molecule.readthedocs.io/en/latest/">molecule</a> the developer could test an Ansible role.</p><h3>FreeBSD in CI</h3><p>Currently there are not any support for FreeBSD in the “public” CI/CD engines, unless you have your own Jenkins cluster (with FreeBSD slave) or Gitlab CI/CD with a FreeBSD Runner. Also there aren’t any docker image for FreeBSD (is a unix distribution, and the docker project over FreeBSD is stuck at version 1.7 which is experimental). Therefore is very hard to test an Ansible Role which involves FreeBSD using molecule (or any other tool) without alter the slave/runner state (or using a VM each time, which is not allowed on public CI engines).</p><h3>Molecule and Openstack</h3><p>Molecule provides also drivers to use <a href="https://www.openstack.org">Openstack</a> for role testing, running molecule init &lt;role-name&gt; --driver Openstack it will create the folder structure for new role (inside the &lt;role-name&gt; folder) and populate the create playbook for virtual machine (alongside with ssh keypair and security group) creation.</p><h3>Molecule and FreeBSD</h3><p>Exploting the Openstack driver and the already described <a href="https://www.carlomaiorano.me/freebsd/2019/01/02/freebsd-openstack.html">FreeBSD Openstack Image</a> you can test your own role on FreeBSD, relying also on the <a href="https://github.com/ansible/community/wiki/BSD">BSD Ansible Community</a> for BSD specific modules. In order to have Python in the FreeBSD image (if you don’t have included, as explained in the article), you can add a prepare.yml to your molecule folder to install Python and create the link needed by molecule.</p><pre>- name: Prepare<br>  hosts: all<br>  gather_facts: false<br>  tasks:<br>    - name: Install python for Ansible<br>      raw: test -e /usr/bin/python || (pkg upgrade -y &amp;&amp; pkg install -y python &amp;&amp; ln -sf /usr/local/bin/python2.7 //usr/bin/python)<br>      become: true<br>      changed_when: false</pre><p>Cheers :)</p><p><em>Originally published at </em><a href="https://www.carlomaiorano.me/freebsd/2019/02/19/freebsd-test.html"><em>https://www.carlomaiorano.me</em></a><em> on February 19, 2019.</em></p><img src="https://medium.com/_/stat?event=post.clientViewed&referrerSource=full_rss&postId=b6ea691b1628" width="1" height="1" alt="">
